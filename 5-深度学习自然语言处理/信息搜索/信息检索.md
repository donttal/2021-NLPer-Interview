# 上游任务 -- 信息检索

## 搜索与信息检索（IR）
对于应用Bert，搜索或IR的问题模式及解决方案流程和QA任务是非常相近的，但是因为任务不同，所以还是有些区别。

搜索任务和QA任务的区别，我综合各方面信息，列一下，主要有三点：

### 相似性
首先，尽管两个任务都是在做Query和Document的匹配，但是匹配时侧重于哪些因素，这两个任务是不同的。两个文本的“相关性”和“语义相似性”代表的内涵是有差异的；所谓“相关性”，更强调字面内容的精确匹配，而“语义相似性”则多涵盖了另外一个意思：就是尽管字面不匹配，但是深层语义方面的相近。QA任务对于这两者都是重视的，可能偏向**语义相似性更多一些**，而搜索任务更偏重**文本匹配**的相关性方面。这是两个任务的第一个不同。

### 文本长度
QA任务的处理对象倾向于短文本；而对搜索任务来说，文档普遍比较长。尽管在判断文档是否与查询相关时，也许只依赖长文档中的几个关键Passage或者几个关键句子，但是关键片段有可能散落在文档的不同地方。在应用Bert的时候，因为Bert对于输入长度有限制，最长输入允许512个单位。于是，如何处理长文档，对于搜索来说比较重要；

### 信息多模态
再次，对于QA这种任务来说，可能文本内包含的信息足够作出判断，所以不需要额外的特征信息；而对于搜索这种任务，尤其是现实生活中的实用化的搜索，而非性质比较单纯的评测中的Ad hoc检索任务。在很多时候，仅仅靠文本可能无法特别有效地判断查询和文档的相关性，其它很多因素也严重影响搜索质量，比如链接分析，网页质量，用户行为数据等各种其它特征也对于最终的判断也起到重要作用。而对于非文本类的信息，Bert貌似不能很好地融合并体现这些信息。推荐领域其实也跟搜索一样，面临类似的问题。

## 应用
我们再归纳下在Ad Hoc检索任务中一般如何应用Bert:一般也是分成两个阶段，
首先利用BM25等经典文本匹配模型或者其它简单快速的模型对文档进行初步排序，取得分前列Top K文档，
然后用复杂的机器学习模型来对Top K返回结果进行重排序。应用Bert的地方明显在搜索重排序阶段，应用模式与QA也是类似的，就是把Query和Document输入Bert，
利用Bert的深层语言处理能力，作出两者是否相关的判断。如果是Passage级别的短文档检索，其实流程基本和QA是一样的；而如果是长文档检索，则需要增加一个如何处理长文档的技术方案，然后再走Bert去做相关性判断。

## 长文档

对于长文档检索任务，因为Bert在输入端无法接受太长的输入，则面临一个如何将长文档缩短的问题。其它过程和短文档检索基本雷同。那么怎么解决搜索中的长文档问题呢？可以参考下列论文的思路。

论文：Simple Applications of BERT for Ad Hoc Document Retrieval

这篇论文首次在信息检索领域应用Bert，并且证明了Bert对于搜索应用能有效提升效果。它同时做了短文档和长文档的实验。短文档利用TREC 2014的微博数据。引入Bert后，在微博搜索任务上，相对目前最好的检索模型，在不同的微博搜索任务中有5%到18%的效果提升，相对基准方法（**BM25+RM3,这是一个强基准，超过大多数其它改进方法**）有20%到30%的效果提升。

第二个数据集是TREC长文档检索任务，这里就体现出搜索和QA任务的不同了。因为要搜索的文档比较长，在重排序阶段，很难把整个文档输入到Bert中，所以这个工作采取了一个简单的方法：把文档分割成句子，**利用Bert判断每个句子和查询Q的相关性，然后累加得分最高的Top N句子（结论是取得分最高的3个句子就够了，再多性能会下降）**，获得文档和查询Q的相关性得分，这样就将长文档问题转化成了文档部分句子的得分累加的模式。实验表明相对强基准BM25+RM3，使用Bert会有大约10%的效果提升。

### 一种搜索领域长文档的解决思路

从上面这篇文章对搜索长文档的处理过程，我们可以进一步对此问题进行深入思考。考虑到搜索任务的特殊性：文档和用户查询的相关性，并不体现在文章中的所有句子中，而是集中体现在文档中的部分句子中。如果这个事实成立，那么一种直观地解决搜索任务中长文档问题的通用思路可以如下：

1. 先通过一定方法，根据查询和文档中的句子，判断两者的相关性，即产生判断函数Score=F(Q,S)，根据Score得分筛选出一个较小的句子子集合Sub_Set(Sentences)，由这些句子来代表文档内容。
2. 这样即可将长文有针对性地缩短。从和查询相关性的角度来说，这样做也不会损失太多信息。
3. 关键是这个F（Q，S）函数如何定义，不同的定义方法可能产生表现不同的效果。

这个F函数，可以被称为搜索领域文档的句子选择函数，这个函数同样可以使用不同的DNN模型来实现。